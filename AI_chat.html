<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>AI 智能问诊</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#f4f8f2;
  --panel:#ffffffee;
  --green:#6fbf9a;
  --yellow:#f3e8a5;
  --border:#ddebe2;
  --text:#2e4a3c;
}

body{
  margin:0;
  font-family:"Noto Serif SC",serif;
  background:var(--bg);
}

/* Header */
header{
  padding:22px 40px;
  background:rgba(255,255,255,.75);
  backdrop-filter:blur(12px);
  border-bottom:1px solid var(--border);
}

/* Chat */
.chat-wrap{
  max-width:900px;
  margin:30px auto;
  padding:0 20px;
}

.messages{
  height:460px;
  overflow-y:auto;
  padding:20px;
  background:var(--panel);
  border-radius:26px;
  border:1px solid var(--border);
}

.msg{margin-bottom:18px;line-height:1.7}
.user{text-align:right}
.ai{color:#4a6f5c}

.input{
  margin-top:20px;
  display:flex;
  gap:14px;
}

textarea{
  flex:1;
  padding:14px;
  border-radius:16px;
  border:1px solid var(--border);
  resize:none;
}

button{
  padding:14px 34px;
  border:none;
  border-radius:999px;
  cursor:pointer;
  background:linear-gradient(135deg,var(--green),var(--yellow));
}

/* ===== Modal ===== */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.35);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.modal-box{
  width:520px;
  background:#fff;
  padding:30px;
  border-radius:26px;
  box-shadow:0 40px 80px rgba(0,0,0,.25);
}

.modal-box h3{margin-top:0}

.row{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  margin-top:16px;
}

input,select{
  padding:12px;
  border-radius:14px;
  border:1px solid var(--border);
  width:100%;
}
</style>
</head>

<body>

<header>
  <h2>AI 智能问诊</h2>
</header>

<!-- 基础信息弹窗 -->
<div class="modal" id="infoModal">
  <div class="modal-box">
    <h3>请先填写基础信息</h3>
    <div class="row">
      <input id="age" placeholder="年龄">
      <select id="gender">
        <option value="">性别</option>
        <option>男</option>
        <option>女</option>
      </select>
      <input id="height" placeholder="身高 (cm)">
      <input id="weight" placeholder="体重 (kg)">
    </div>
    <button style="margin-top:20px" onclick="confirmInfo()">确认进入问诊</button>
  </div>
</div>

<div class="chat-wrap">
  <div class="messages" id="msgs"></div>

  <div class="input">
    <textarea id="q" rows="2" placeholder="请描述你的症状或问题..."></textarea>
    <button onclick="send()">发送</button>
  </div>
</div>

<script>
let baseInfo="";

function confirmInfo(){
  if(!age.value || !gender.value){
    alert("请至少填写年龄和性别");
    return;
  }
  baseInfo =
    `患者信息：性别${gender.value}，${age.value}岁，`+
    `身高${height.value || '未知'}cm，`+
    `体重${weight.value || '未知'}kg。`;
  document.getElementById("infoModal").style.display="none";
}

function send(){
  const q = document.getElementById("q").value.trim();
  if(!q) return;

  msgs.innerHTML += `<div class="msg user">${q}</div>`;
  document.getElementById("q").value="";
  msgs.scrollTop = msgs.scrollHeight;

  fetch("http://127.0.0.1:5000/ask",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ question: baseInfo + q })
  })
  .then(r=>r.json())
  .then(d=>{
    msgs.innerHTML += `<div class="msg ai">${d.answer}</div>`;
    msgs.scrollTop = msgs.scrollHeight;
  });
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>评论管理 - 管理员后台</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei";}
        body {background:#f5f7fa;}
        .header {background:#2c3e50;color:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;}
        .header a {color:#fff;text-decoration:none;margin-left:20px;}
        .sidebar {width:200px;background:#34495e;height:calc(100vh - 60px);position:fixed;top:60px;left:0;padding-top:20px;}
        .sidebar a {display:block;color:#ecf0f1;padding:10px 20px;text-decoration:none;}
        .sidebar a:hover, .sidebar a.active {background:#2c3e50;}
        .content {margin-left:220px;padding:30px;}
        .card {background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);margin-bottom:20px;}
        .alert {padding:10px;margin-bottom:15px;border-radius:4px;}
        .alert-danger {background:#f2dede;color:#a94442;}
        .alert-success {background:#dff0d8;color:#3c763d;}
        .alert-warning {background:#fcf8e3;color:#8a6d3b;}
        table {width:100%;border-collapse:collapse;margin-top:20px;}
        table th, table td {padding:12px;border:1px solid #ddd;text-align:center;}
        table th {background:#f5f5f5;}
        .btn {padding:6px 12px;border:none;border-radius:4px;cursor:pointer;margin:0 5px;}
        .btn-danger {background:#e74c3c;color:#fff;}
        .btn-warning {background:#f39c12;color:#fff;}
        .btn-success {background:#2ecc71;color:#fff;}
        .btn-info {background:#3498db;color:#fff;}
        .form-row {display:flex;gap:10px;margin-top:10px;}
        .form-row select, .form-row textarea {width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;}
        textarea {resize: vertical;min-height:80px;}
    </style>
</head>
<body>
    <div class="header">
        <h3>中药管理系统 - 管理员后台</h3>
        <div>
            <span>当前登录：{{ username }}</span>
            <a href="{{ url_for('admin.logout') }}">退出登录</a>
        </div>
    </div>
    <div class="sidebar">
        <a href="{{ url_for('admin.dashboard') }}">后台首页</a>
        <a href="{{ url_for('admin.users') }}">用户管理</a>
        <a href="{{ url_for('admin.comments') }}" class="active">评论管理</a>
    </div>
    <div class="content">
        <div class="card">
            <h2>新增评论</h2>
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, msg in messages %}
                        <div class="alert alert-{{ category }}">{{ msg }}</div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <form method="POST">
                <input type="hidden" name="action" value="create">
                <div class="form-row">
                    <select name="user_id" required>
                        <option value="">请选择用户</option>
                        {% for u in users %}
                            <option value="{{ u.id }}">{{ u.username }} (ID:{{ u.id }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-row">
                    <textarea name="content" placeholder="请输入评论内容" required></textarea>
                </div>
                <div class="form-row" style="justify-content:flex-end;">
                    <button type="submit" class="btn btn-success">创建评论</button>
                </div>
            </form>
        </div>
        <div class="card">
            <h2>评论列表</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>用户名</th>
                        <th>内容</th>
                        <th>创建时间</th>
                        <th>更新时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in comments %}
                    <tr>
                        <td>{{ c.id }}</td>
                        <td>{{ c.username if c.username else '用户已删除' }} ({{ c.user_id }})</td>
                        <td>
                            <form method="POST" style="display:flex;flex-direction:column;gap:8px;">
                                <input type="hidden" name="action" value="update">
                                <input type="hidden" name="comment_id" value="{{ c.id }}">
                                <textarea name="content" required>{{ c.content }}</textarea>
                                <div style="display:flex;gap:8px;justify-content:flex-end;">
                                    <button type="submit" class="btn btn-info">保存修改</button>
                                </div>
                            </form>
                        </td>
                        <td>{{ c.created_at }}</td>
                        <td>{{ c.updated_at }}</td>
                        <td>
                            <form method="POST" onsubmit="return confirm('确定删除该评论？');">
                                <input type="hidden" name="action" value="delete">
                                <input type="hidden" name="comment_id" value="{{ c.id }}">
                                <button type="submit" class="btn btn-danger">删除</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if not comments %}
                    <tr>
                        <td colspan="6">暂无评论</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>

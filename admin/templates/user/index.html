<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>我的主页</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;font-family:"Microsoft YaHei";}
        body {background:#f5f7fa;}
        .header {background:#2c3e50;color:#fff;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;}
        .header a {color:#fff;text-decoration:none;margin-left:20px;}
        .page {width:90%;margin:30px auto;}
        .cards {display:grid;grid-template-columns:1fr 2fr;gap:20px;}
        .card {background:#fff;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
        .card h2 {margin-bottom:15px;color:#34495e;}
        .info p {margin:8px 0;color:#555;}
        .alert {padding:10px;margin-bottom:15px;border-radius:4px;}
        .alert-danger {background:#f2dede;color:#a94442;}
        .alert-success {background:#dff0d8;color:#3c763d;}
        .alert-warning {background:#fcf8e3;color:#8a6d3b;}
        textarea {width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;resize:vertical;min-height:120px;}
        .btn {padding:10px 16px;border:none;border-radius:4px;cursor:pointer;background:#2ecc71;color:#fff;margin-top:10px;}
        .btn:hover {background:#27ae60;}
        .comment-list {list-style:none;margin-top:10px;}
        .comment-item {border-bottom:1px solid #eee;padding:10px 0;}
        .comment-item:last-child {border-bottom:none;}
        .comment-meta {color:#999;font-size:13px;margin-bottom:5px;}
        .empty {color:#aaa;text-align:center;margin:20px 0;}
    </style>
</head>
<body>
    <div class="header">
        <h3>中药管理系统 - 我的主页</h3>
        <div>
            <span>当前登录：{{ user.username }}</span>
            <a href="{{ url_for('user.logout') }}">退出登录</a>
        </div>
    </div>
    <div class="page">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, msg in messages %}
                    <div class="alert alert-{{ category }}">{{ msg }}</div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="cards">
            <div class="card">
                <h2>我的信息</h2>
                <div class="info">
                    <p><strong>用户名：</strong>{{ user.username }}</p>
                    <p><strong>手机号：</strong>{{ user.phonenumber }}</p>
                    <p><strong>邮箱：</strong>{{ user.email }}</p>
                    <p><strong>注册时间：</strong>{{ user.created_at }}</p>
                </div>
            </div>
            <div class="card">
                <h2>写评论</h2>
                <form method="POST">
                    <textarea name="content" placeholder="请输入您的评论..." required></textarea>
                    <button type="submit" class="btn">提交评论</button>
                </form>
            </div>
        </div>

        <div class="card" style="margin-top:20px;">
            <h2>我的评论</h2>
            <ul class="comment-list">
                {% for c in comments %}
                <li class="comment-item">
                    <div>{{ c.content }}</div>
                    <div class="comment-meta">创建：{{ c.created_at }} | 更新：{{ c.updated_at }}</div>
                </li>
                {% endfor %}
                {% if not comments %}
                <li class="empty">还没有评论，快来写下第一条吧！</li>
                {% endif %}
            </ul>
        </div>
    </div>
</body>
</html>